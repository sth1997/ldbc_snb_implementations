g.V().hasLabel('Person').has('id',$personId).out('knows').union(identity(), out('knows')).dedup().by('id').has('id', neq($personId)).filter(__.out('isLocatedIn').has('name',without($countryXName,$countryYName))).as('friend').filter(__.in('hasCreator').has('creationDate',inside($startDate,$endDate)).out('isLocatedIn').values('name').fold().filter({v -> v.get().contains($countryXName) && v.get().contains($countryYName)})).group().by().by(__.in('hasCreator').has('creationDate',inside($startDate,$endDate)).out('isLocatedIn').has('name', $countryXName).count()).unfold().order().by(select(values), decr).by(select(keys).values('id')).limit(20)